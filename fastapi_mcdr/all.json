{
  "meta": {
    "schema_version": 4,
    "id": "fastapi_mcdr",
    "name": "FastAPI MCDR",
    "version": "1.0.0",
    "link": "https://github.com/AnzhiZhang/MCDReforgedPlugins/tree/master/src/fastapi_mcdr",
    "authors": [
      "Andy Zhang"
    ],
    "dependencies": {},
    "requirements": [
      "fastapi",
      "uvicorn"
    ],
    "description": {
      "en_us": "Provides HTTP API.",
      "zh_cn": "æä¾› HTTP APIã€‚"
    }
  },
  "plugin": {
    "schema_version": 1,
    "id": "fastapi_mcdr",
    "authors": [
      "Andy Zhang"
    ],
    "repository": "https://github.com/AnzhiZhang/MCDReforgedPlugins",
    "branch": "master",
    "related_path": "src/fastapi_mcdr",
    "labels": [
      "api"
    ],
    "introduction": {
      "en_us": "# FastAPI\n\n[ç®€ä½“ä¸­æ–‡](https://github.com/AnzhiZhang/MCDReforgedPlugins/tree/master/src/fastapi_mcdr/readme_cn.md)\n\n> Provides HTTP API\n\n## Quick Start\n\nIn general, there are two things you need to do in your plugin:\n\n1. Check FastAPI's status when loading. If it's ready for registration, directly register the API.\n2. Register a listener for the ACCEPT event to register the API when it becomes acceptable.\n\nSpecifically, you need to add the following code:\n\n```python\ndef on_load(server, prev_module):\n    # register if fastapi_mcdr is ready\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n    if fastapi_mcdr is not None and fastapi_mcdr.is_ready():\n        register_apis(server)\n\n    # register event listener\n    server.register_event_listener(\n        \"fastapi_mcdr.accept\",\n        register_apis\n    )\n\ndef register_apis(server):\n    # save plugin id and fastapi_mcdr instance\n    id_ = server.get_self_metadata().id\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n\n    # register api\n    fastapi_mcdr.add_api_route(\n        id_,\n        path=\"/test\",\n        endpoint=test,\n        response_model=Dict[str, str],\n        methods=[\"GET\"],\n    )\n\nasync def test():\n    return \"Hello, world!\"\n```\n\nVisit <http://localhost:8080/docs> to view the API documentation.\n\n## Technical Details\n\n### Loading\n\nIn theory, providing an HTTP API externally should be a soft dependency. That's why checking FastAPI's status and registering an ACCEPT event listener are necessary. The following diagram illustrates the process of loading FastAPI and custom plugins:\n\nLoad FastAPI first, then load custom plugins:\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note right of FastAPI: FastAPI Load\n    Note right of FastAPI: FastAPI Dispatch ACCEPT Event\n\n    Note left of Test: Test Load\n\n    Test ->> FastAPI: Loaded?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: is_ready?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: Register API\n\n    Note left of Test: Test Register ACCEPT Event\n```\n\nLoad custom plugins first, then load FastAPI:\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note left of Test: Test Load\n\n    Test ->> FastAPI: Loaded?\n    FastAPI ->> Test: No!\n\n    Note left of Test: Test Register ACCEPT Event\n\n    Note right of FastAPI: FastAPI Load\n\n    FastAPI ->> Test: Dispatch ACCEPT Event\n    Test ->> FastAPI: Register API\n```\n\nWith this design, you can achieve soft plugin dependency without worrying about the order of plugin loading. The following diagram shows the scenario of any plugin being reloaded:\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note right of FastAPI: FastAPI Reload\n\n    FastAPI ->> Test: Dispatch ACCEPT Event\n    Test ->> FastAPI: Register API\n\n    Note left of Test: Test Reload\n\n    Test ->> FastAPI: Loaded?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: is_ready?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: Register API\n\n    Note left of Test: Test Register ACCEPT Event\n```\n\n## Standards\n\n### ACCEPT Event\n\nEvent name: `fastapi_mcdr.accept`\n\nAn instance of `PluginEvent` for this event is also exposed as `ACCEPT_EVENT`.\n\n### Public Functions\n\n#### is_ready\n\nThe plugin's status for accepting registration. If forcefully registered, it will raise a `RuntimeError`.\n\n#### add_api_route\n\nAccepts parameters almost identical to the `add_api_route` function of the fastapi library. However, the first parameter `plugin_id` should be the plugin id, so that the plugin id is used as a prefix when registering the path.\n\nIn other words, if the id parameter is `test` and the path parameter is `/test`, then the registered path is `/test/test`.\n",
      "zh_cn": "# FastAPI\n\n[English](https://github.com/AnzhiZhang/MCDReforgedPlugins/tree/master/src/fastapi_mcdr/readme.md)\n\n> æä¾› HTTP API\n\n## å¿«é€Ÿå¼€å§‹\n\næ€»åœ°æ¥è¯´ï¼Œæ‚¨éœ€è¦åœ¨æ‚¨çš„æ’ä»¶ä¸­åšä¸¤ä»¶äº‹ï¼š\n\n1. åŠ è½½æ—¶æ£€æŸ¥ FastAPI çŠ¶æ€ï¼Œå¦‚å·²å¯ä»¥æ¥å—æ³¨å†Œï¼Œåˆ™ç›´æ¥æ³¨å†Œ APIã€‚\n1. ç›´æ¥æ³¨å†Œ ACCEPT äº‹ä»¶çš„ç›‘å¬å™¨ï¼Œä»¥ä¾¿å¯ä»¥æ³¨å†Œæ—¶æ³¨å†Œ APIã€‚\n\nå…·ä½“åœ°è¯´ï¼Œæ‚¨éœ€è¦æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š\n\n```python\ndef on_load(server, prev_module):\n    # register if fastapi_mcdr is ready\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n    if fastapi_mcdr is not None and fastapi_mcdr.is_ready():\n        register_apis(server)\n\n    # register event listener\n    server.register_event_listener(\n        \"fastapi_mcdr.accept\",\n        register_apis\n    )\n\ndef register_apis(server):\n    # save plugin id and fastapi_mcdr instance\n    id_ = server.get_self_metadata().id\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n\n    # register api\n    fastapi_mcdr.add_api_route(\n        id_,\n        path=\"/test\",\n        endpoint=test,\n        response_model=Dict[str, str],\n        methods=[\"GET\"],\n    )\n\nasync def test():\n    return \"Hello, world!\"\n```\n\nè®¿é—® <http://localhost:8080/docs> å³å¯æŸ¥çœ‹ API æ–‡æ¡£ã€‚\n\n## æŠ€æœ¯ç»†èŠ‚\n\n### åŠ è½½\n\nç†è®ºä¸Šæ¥è¯´ï¼Œå¯¹å¤–æä¾› HTTP API åº”å½“æ˜¯ä¸€ç§è½¯ä¾èµ–ï¼Œè¿™ä¾¿æ˜¯éœ€è¦æ£€æŸ¥ FastAPI çŠ¶æ€å¹¶åŒæ—¶æ³¨å†Œ ACCEPT äº‹ä»¶ç›‘å¬å™¨çš„åŸå› ã€‚ä¸‹å›¾å±•ç¤ºäº† FastAPI æ’ä»¶å’Œè‡ªå®šä¹‰æ’ä»¶å…ˆååŠ è½½çš„æµç¨‹å›¾ï¼š\n\nå…ˆåŠ è½½ FastAPIï¼Œå†åŠ è½½è‡ªå®šä¹‰æ’ä»¶ï¼š\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note right of FastAPI: FastAPI åŠ è½½\n    Note right of FastAPI: FastAPI åˆ†å‘ ACCEPT äº‹ä»¶\n\n    Note left of Test: Test åŠ è½½\n\n    Test ->> FastAPI: å·²åŠ è½½ï¼Ÿ\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: is_ready?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: æ³¨å†Œ API\n\n    Note left of Test: Test æ³¨å†Œ ACCEPT äº‹ä»¶\n```\n\nå…ˆåŠ è½½è‡ªå®šä¹‰æ’ä»¶ï¼Œå†åŠ è½½ FastAPIï¼š\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note left of Test: Test åŠ è½½\n\n    Test ->> FastAPI: å·²åŠ è½½ï¼Ÿ\n    FastAPI ->> Test: No!\n\n    Note left of Test: Test æ³¨å†Œ ACCEPT äº‹ä»¶\n\n    Note right of FastAPI: FastAPI åŠ è½½\n\n    FastAPI ->> Test: åˆ†å‘ ACCEPT äº‹ä»¶\n    Test ->> FastAPI: æ³¨å†Œ API\n```\n\né€šè¿‡è¿™ä¸ªè®¾è®¡ï¼Œå³å¯å®ç°æ’ä»¶çš„è½¯ä¾èµ–ï¼Œä¸”æ— éœ€è€ƒè™‘æ’ä»¶åŠ è½½é¡ºåºçš„é—®é¢˜ã€‚ä¸‹å›¾å±•ç¤ºäº†ä»»æ„æ’ä»¶é‡è½½çš„æƒ…å†µï¼š\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note right of FastAPI: FastAPI é‡è½½\n\n    FastAPI ->> Test: åˆ†å‘ ACCEPT äº‹ä»¶\n    Test ->> FastAPI: æ³¨å†Œ API\n\n    Note left of Test: Test é‡è½½\n\n    Test ->> FastAPI: å·²åŠ è½½ï¼Ÿ\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: is_ready?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: æ³¨å†Œ API\n\n    Note left of Test: Test æ³¨å†Œ ACCEPT äº‹ä»¶\n```\n\n## æ ‡å‡†\n\n### ACCEPT äº‹ä»¶\n\näº‹ä»¶åï¼š`fastapi_mcdr.accept`\n\nè¯¥äº‹ä»¶çš„ `PluginEvent` å®ä¾‹ä¹Ÿä¼šä»¥ `ACCEPT_EVENT` åå…¬å¼€ã€‚\n\n### å…¬å¼€å‡½æ•°\n\n#### is_ready\n\næ’ä»¶å¯ä»¥æ¥å—æ³¨å†Œçš„çŠ¶æ€ï¼Œå¦‚å¼ºè¡Œæ³¨å†Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ª `RuntimeError`ã€‚\n\n#### add_api_route\n\næ¥å—çš„å‚æ•°å‡ ä¹ä¸ fastapi åº“çš„ `add_api_route` å‡½æ•°ç›¸åŒï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªå‚æ•° `plugin_id` åº”å½“ä¼ å…¥æ’ä»¶çš„ idï¼Œä»¥ä¾¿æ³¨å†Œè·¯å¾„æ—¶ä»¥æ’ä»¶ id ä¸ºå‰ç¼€ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ id å‚æ•°ä¸º `test`ï¼Œpath å‚æ•°ä¸º `/test`ï¼Œåˆ™æ³¨å†Œçš„è·¯å¾„ä¸º `/test/test`ã€‚\n"
    }
  },
  "release": {
    "schema_version": 8,
    "id": "fastapi_mcdr",
    "latest_version": "1.0.0",
    "latest_version_index": 0,
    "releases": [
      {
        "url": "https://github.com/AnzhiZhang/MCDReforgedPlugins/releases/tag/fastapi_mcdr-v1.0.0",
        "name": "fastapi_mcdr: v1.0.0",
        "tag_name": "fastapi_mcdr-v1.0.0",
        "created_at": "2023-12-21T16:37:50Z",
        "description": "## 1.0.0 (2023-12-21)\n\n\n### Features\n\n* **fastapi_mcdr:** ğŸ‰ create fastapi_mcdr ([84247a7](https://github.com/AnzhiZhang/MCDReforgedPlugins/commit/84247a77315a248bc6489e15083352eb4559b68e))",
        "prerelease": false,
        "asset": {
          "id": 141837233,
          "name": "FastAPIMCDR-v1.0.0.mcdr",
          "size": 2344,
          "download_count": 55,
          "created_at": "2023-12-21T16:38:12Z",
          "browser_download_url": "https://github.com/AnzhiZhang/MCDReforgedPlugins/releases/download/fastapi_mcdr-v1.0.0/FastAPIMCDR-v1.0.0.mcdr",
          "hash_md5": "bd33e16eb661704fff7f43e17d9dbff3",
          "hash_sha256": "5bda7446df976ba0992d89a789ce900eed8ec792b23c8b580569696a587bb3d3"
        },
        "meta": {
          "schema_version": 4,
          "id": "fastapi_mcdr",
          "name": "FastAPI MCDR",
          "version": "1.0.0",
          "link": "https://github.com/AnzhiZhang/MCDReforgedPlugins/tree/master/fastapi_mcdr",
          "authors": [
            "Andy Zhang"
          ],
          "dependencies": {},
          "requirements": [
            "fastapi",
            "uvicorn"
          ],
          "description": {
            "en_us": "Provides HTTP API.",
            "zh_cn": "æä¾› HTTP APIã€‚"
          }
        }
      }
    ]
  },
  "repository": {
    "url": "https://github.com/AnzhiZhang/MCDReforgedPlugins",
    "name": "MCDReforgedPlugins",
    "full_name": "AnzhiZhang/MCDReforgedPlugins",
    "html_url": "https://github.com/AnzhiZhang/MCDReforgedPlugins",
    "description": "MCDReforged Plugins",
    "archived": false,
    "stargazers_count": 92,
    "watchers_count": 92,
    "forks_count": 57,
    "readme": "# FastAPI\n\n[ç®€ä½“ä¸­æ–‡](https://github.com/AnzhiZhang/MCDReforgedPlugins/tree/master/src/fastapi_mcdr/readme_cn.md)\n\n> Provides HTTP API\n\n## Quick Start\n\nIn general, there are two things you need to do in your plugin:\n\n1. Check FastAPI's status when loading. If it's ready for registration, directly register the API.\n2. Register a listener for the ACCEPT event to register the API when it becomes acceptable.\n\nSpecifically, you need to add the following code:\n\n```python\ndef on_load(server, prev_module):\n    # register if fastapi_mcdr is ready\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n    if fastapi_mcdr is not None and fastapi_mcdr.is_ready():\n        register_apis(server)\n\n    # register event listener\n    server.register_event_listener(\n        \"fastapi_mcdr.accept\",\n        register_apis\n    )\n\ndef register_apis(server):\n    # save plugin id and fastapi_mcdr instance\n    id_ = server.get_self_metadata().id\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n\n    # register api\n    fastapi_mcdr.add_api_route(\n        id_,\n        path=\"/test\",\n        endpoint=test,\n        response_model=Dict[str, str],\n        methods=[\"GET\"],\n    )\n\nasync def test():\n    return \"Hello, world!\"\n```\n\nVisit <http://localhost:8080/docs> to view the API documentation.\n\n## Technical Details\n\n### Loading\n\nIn theory, providing an HTTP API externally should be a soft dependency. That's why checking FastAPI's status and registering an ACCEPT event listener are necessary. The following diagram illustrates the process of loading FastAPI and custom plugins:\n\nLoad FastAPI first, then load custom plugins:\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note right of FastAPI: FastAPI Load\n    Note right of FastAPI: FastAPI Dispatch ACCEPT Event\n\n    Note left of Test: Test Load\n\n    Test ->> FastAPI: Loaded?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: is_ready?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: Register API\n\n    Note left of Test: Test Register ACCEPT Event\n```\n\nLoad custom plugins first, then load FastAPI:\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note left of Test: Test Load\n\n    Test ->> FastAPI: Loaded?\n    FastAPI ->> Test: No!\n\n    Note left of Test: Test Register ACCEPT Event\n\n    Note right of FastAPI: FastAPI Load\n\n    FastAPI ->> Test: Dispatch ACCEPT Event\n    Test ->> FastAPI: Register API\n```\n\nWith this design, you can achieve soft plugin dependency without worrying about the order of plugin loading. The following diagram shows the scenario of any plugin being reloaded:\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note right of FastAPI: FastAPI Reload\n\n    FastAPI ->> Test: Dispatch ACCEPT Event\n    Test ->> FastAPI: Register API\n\n    Note left of Test: Test Reload\n\n    Test ->> FastAPI: Loaded?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: is_ready?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: Register API\n\n    Note left of Test: Test Register ACCEPT Event\n```\n\n## Standards\n\n### ACCEPT Event\n\nEvent name: `fastapi_mcdr.accept`\n\nAn instance of `PluginEvent` for this event is also exposed as `ACCEPT_EVENT`.\n\n### Public Functions\n\n#### is_ready\n\nThe plugin's status for accepting registration. If forcefully registered, it will raise a `RuntimeError`.\n\n#### add_api_route\n\nAccepts parameters almost identical to the `add_api_route` function of the fastapi library. However, the first parameter `plugin_id` should be the plugin id, so that the plugin id is used as a prefix when registering the path.\n\nIn other words, if the id parameter is `test` and the path parameter is `/test`, then the registered path is `/test/test`.\n",
    "readme_url": "https://raw.githubusercontent.com/AnzhiZhang/MCDReforgedPlugins/master/src/fastapi_mcdr/readme.md"
  }
}